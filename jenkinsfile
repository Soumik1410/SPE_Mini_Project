pipeline {

	agent any

	environment {
		GIT_CREDENTIALS = 'github-token'
 	}

	stages {
		stage('Checkout') {
	            steps {
	                script {
	                    checkout scm: [
	                        $class: 'GitSCM',
	                        branches: [[name: '*/master']],
	                        userRemoteConfigs: [[
	                            url: 'https://github.com/Soumik1410/SPE_Mini_Project.git',
	                            credentialsId: "${GIT_CREDENTIALS}"
	                        ]]
	                    ]
	                }
	            }
        	}

		stage("build") {
			steps {
				sh 'mvn clean package'
				echo 'Build successfully completed.'
			}
		}

		stage("Build Docker Image") {
			steps {
                		script {
                    			sh 'docker build -t calculator_mt2024153:latest .'
					echo 'Docker Image successfully created.'
                		}
            		}
        	}

		stage('Pushing Docker Image to Hub') {
	        	steps {
	                	script {
	                    		withDockerRegistry([credentialsId: 'dockerhub-creds', url: 'https://index.docker.io/v1/']) {
	                        	sh "docker push calculator_mt2024153:latest"
	                    	}
	        	}
	        }

		stage("test") {
			steps {
				echo 'Testing'
			}
		}

		stage("deploy") {
			steps {
				echo 'Successfully deployed and running.'
			}
		}
	}
}
